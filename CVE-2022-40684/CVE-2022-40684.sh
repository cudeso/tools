#!/bin/bash

# Query TeamCymru for Fortigate "fortigate-belsen-leak"
#   https://github.com/arsolutioner/fortigate-belsen-leak/tree/main
#
# Koen Van Impe
#

if [ -z "$1" ]; then
  echo "Usage: $0 <input_file>"
  exit 1
fi

INPUT_FILE="$1"
TEMP_FILE="ips_only.txt"
QUERY_FILE="cymru_query.txt"
RAW_WHOIS_OUTPUT="whois_output_raw.txt"


awk -F: '{print $1}' "$INPUT_FILE" > "$TEMP_FILE"
echo "begin" > "$QUERY_FILE"
echo "verbose" >> "$QUERY_FILE"  # Include verbose mode for detailed output
cat "$TEMP_FILE" >> "$QUERY_FILE"
echo "end" >> "$QUERY_FILE"
nc whois.cymru.com 43 < "$QUERY_FILE" > "$RAW_WHOIS_OUTPUT"

echo "IPs in $TEMP_FILE"
echo "Whois results in $RAW_WHOIS_OUTPUT"
